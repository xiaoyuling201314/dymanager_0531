require(["../config.min","../base.min"],function(){require(["common/lightbox.min"],function(e){e.run(".gallery")}),
	require(["common/pagination.min"],
   function(){$("#pagination").pagination({pageCount:pageCount,current:curPage,
	   callback:function(n){var t=n.getCurrent();$("#listForm input[name='curPage']").val(t),$("#listForm").submit()}})}),
	   require(["common/pagination.min"],
			   function(){$("#paginationSelect").pagination({pageCount:pageCountMateriel,current:curPageMateriel,
				   callback:function(n){var t=n.getCurrent();var materielKeys=$("input[name=materielKeys]").val();$("#listMaterForm input[name='curPage']").val(t),//$("#listMaterForm").submit()
					$.ajax({
					url : "completeService/selectMateriel.do",
					type : "POST",
					dataType : "json",
					data : {"materielKeys":materielKeys,"curPage":t},
					success : function(data) {
					var json = eval(data.listData); //数组 
					$("#materForm tr").empty("");
					var serNo=((t-1)*pageSizeMateriel)+1;
			             $.each(json, function (index, item) {  
			                 //循环获取数据      
			            	 var serNoright=(serNo+index);
			                 if(json[index].picture!='' && !json[index].drawings.length>0){
			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
			                 }else if(json[index].drawings.length>0 && json[index].picture==''){//只有图纸
			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
			                 }else if (json[index].picture!='' &&  json[index].drawings.length>0){//图片图纸都有
			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;' ><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
			                 }else{//没有图片图纸
			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'></td><td class='viewDrawing'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
			                 }
			             });
						}
					})
				   }})}),
				   
	   require(["common/modal.min"]),require(["common/select.min"],function(e){e.selectAll("selectAll","for-all"),e.selectAll("selectAll2","for-all2")}),require(["common/alert.min"],
		function(e){$(".delete").on("click",function(){
			var comDetailId = $(this).attr("data-id");
			e.confirm("您确定要删除吗？", function() {
				$.ajax({
					url : "completeService/deleteDetail.do",
					type : "POST",
					data : {
						"comDetailId" : comDetailId,"curPage":curPage
					},
					dataType:"json",
					success : function(data) {
				           location.reload();
					},
					error : function() {
						alert("删除失败");
					}
				})
			})
		})})
		//设置物料搜索事件
		$(function(){
	  		var pageCountMaterielSelect=$("[name=pageCountMaterielSelect]").val();
	  		var curPageMaterieSelectl=$("[name=curPageMaterielSelect]").val();
		    $("#search").on("click",function(){
		        var materielKeys=$("input[name=materielKeys]").val();
		  		$.ajax({
		  		url : "completeService/selectMateriel.do",
		  		type : "POST",
		  		dataType : "json",
		  		data : {"materielKeys":materielKeys,"curPage":1},
		  		success : function(data) {
		  		var json = eval(data.listData); //数组 
		  		$("#materForm tr").empty("");
		               $.each(json, function (index, item) {  
		            	   var serNoright=(index+1);  
		                   if(json[index].picture!='' && !json[index].drawings.length>0){
		                	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
		                   }else if(json[index].drawings.length>0 && json[index].picture==''){//只有图纸
		                	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
		                   }else if (json[index].picture!='' &&  json[index].drawings.length>0){//图片图纸都有
		                	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;' ><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
		                   }else{//没有图片图纸
		                	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'></td><td class='viewDrawing'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
		                   }
		                 });
		               //移除分页参数
		               $("#listMaterForm input[name='curPage']").val(1)
		               $("#paginationSelect").remove();
		               $("[name=pageCountMaterielSelect]").remove();
		    	       $("[name=pageSizeMaterielSelect]").remove();
		    	       $("[name=curPageMaterielSelect]").remove();
		    	       $("[name=recordCountMaterielSelect]").remove();
		    	       $("#materForm").append('<input type="hidden" name="pageCountMaterielSelect" value="'+data.pDataMateriel.pageCount+'"/>');
		    	       $("#materForm").append('<input type="hidden" name="pageSizeMaterielSelect" value="'+data.pDataMateriel.pageSize+'"/>');
		    	       $("#materForm").append('<input type="hidden" name="curPageMaterielSelect"  value="'+data.pDataMateriel.curPage+'"/>');
		    	       $("#materForm").append('<input type="hidden" name="recordCountMaterielSelect" value="'+data.pDataMateriel.recordCount+'"/>');
		    	  		//初始化分页控件栏
		    	       var pageCountMaterielSelect=$("[name=pageCountMaterielSelect]").val();
				  		var curPageMaterieSelectl=$("[name=curPageMaterielSelect]").val();
//			               require(["common/pagination.min"],
//		 			   function(){$("#paginationSelect2").pagination(
//		 					   {pageCount:pageCountMaterielSelect,current:curPageMaterieSelectl,
//		 				   callback:function(n){
//		 					   var t=n.getCurrent();var materielKeys=$("input[name=materielKeys]").val();$("#listMaterForm input[name='curPage']").val(t),//$("#listMaterForm").submit()
//		 					$.ajax({
//		 					url : "completeService/selectMateriel.do",
//		 					type : "POST",
//		 					dataType : "json",
//		 					data : {"materielKeys":materielKeys,"curPage":t},
//		 					success : function(data) {
//		 					var json = eval(data.listData); //数组 
//		 					$("#materForm tr").empty("");
//		 					var serNo=((t-1)*10)+1;//(pDataStartIndex+1);
//		 			             $.each(json, function (index, item) {  
//		 			                 //循环获取数据      
//		 			            	 var serNoright=(serNo+index);
//		 			                 if(json[index].picture!='' && !json[index].drawings.length>0){
//		 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
//		 			                 }else if(json[index].drawings.length>0 && json[index].picture==''){//只有图纸
//		 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td>"+json[index].comment+"</td><td></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
//		 			                 }else if (json[index].picture!='' &&  json[index].drawings.length>0){//图片图纸都有
//		 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;' ><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
//		 			                 }else{//没有图片图纸
//		 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td>"+json[index].comment+"</td><td class='gallery'></td><td class='viewDrawing'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
//		 			                 }
//		 			             });
//		 						}
//		 					})
//		 				   }})})
		  			}
		  		});
//		  		//分页切换功能
//		  		var pageCountMaterielSelect=$("[name=pageCountMaterielSelect]").val();
//		  		var curPageMaterieSelectl=$("[name=curPageMaterielSelect]").val();
	               require(["common/pagination.min"],
 			   function(){$("#paginationSelect2").pagination(
 					   {pageCount:pageCountMaterielSelect,current:curPageMaterieSelectl,
 				   callback:function(n){
 					   var t=n.getCurrent();var materielKeys=$("input[name=materielKeys]").val();$("#listMaterForm input[name='curPage']").val(t),//$("#listMaterForm").submit()
 					$.ajax({
 					url : "completeService/selectMateriel.do",
 					type : "POST",
 					dataType : "json",
 					data : {"materielKeys":materielKeys,"curPage":t},
 					success : function(data) {
 					var json = eval(data.listData); //数组 
 					$("#materForm tr").empty("");
 					var serNo=((t-1)*10)+1;//(pDataStartIndex+1);
 			             $.each(json, function (index, item) {  
 			                 //循环获取数据      
 			            	 var serNoright=(serNo+index);
 			                 if(json[index].picture!='' && !json[index].drawings.length>0){
 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
 			                 }else if(json[index].drawings.length>0 && json[index].picture==''){//只有图纸
 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"'><label for='select"+serNoright+"' ></label> </div></td> </tr>");
 			                 }else if (json[index].picture!='' &&  json[index].drawings.length>0){//图片图纸都有
 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></td><td class='viewDrawing'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;' ><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
 			                 }else{//没有图片图纸
 			              	   $("#materForm").append("<tr><td>"+serNoright+"</td> <td>"+json[index].materielNo+"</td> <td>"+json[index].materielTypeId.materielTypeName+"</td> <td class='showMaterielStyle'>"+json[index].materielName+"</td><td class='showMaterielStyle'>"+json[index].modelSpecification+"</td><td class='showCommentStyle'>"+json[index].comment+"</td><td class='gallery'></td><td class='viewDrawing'></td><td style='width: 50px;'> <div class='checkbox' style='margin-right:-5px;'><input type='checkbox' value='"+json[index].materielNo+"' class='for-all"+serNoright+"' name='selectId' onchange='changeallsel(this)'  id='select"+serNoright+"' ><label for='select"+serNoright+"' ></label> </div></td> </tr>");
 			                 }
 			             });
 						}
 					})
 				   }})})
		  		})
				//BOM单导入功能 start
		  		$("#btnSave").on("click",function(){
		  			var fileName=$("[name=fileName]").val();
		  			var myFile=$("[name=myFile]").val();
		  			//var reg=/^(\w|[.-]|[\u4e00-\u9fa5]|\s){1,255}$/;
		  			 var reg=/^[^*\/\\|:<>?\"]*$/;
		  			    if(fileName!='' && myFile !=''){
		  			    	 if(!reg.test(fileName)){
		  					    $(".fileNameMessage").html("文件名称不能包含<br/>下列任何字符：\ / \\: * ? \" < > |");
		  					 }else{
		  			       var formData = new FormData($("#completeForm")[0]);  // 要求使用的html对象
		  			     $.ajax({  
		  			          async: false, 
		  			          url: 'completeService/importComplete.do' ,  
		  			          type: 'POST',  
		  			          data: formData, 
		  			          cache: false,  
		  			          processData: false, 
		  			          contentType: false,  
		  			          dataType:"json",
		  			          success: function (returndata) { 
			  			          if(returndata.count>0){
			  			             alert("导入成功"+returndata.count+"条数据");
			  			              location.reload();
			  			          }else if(returndata.count==0){
			  			             alert("导入成功"+returndata.count+"条数据，请检查数据文件");
			  			          }else{
			  			              alert("导入失败，请检查数据文件");
			  			          }
		  			            
		  	                    
		  			          },  
		  			          error: function (returndata) {  
		  			              alert("操作失败");  
		  			          }  
		  			     }); 
		  					 }
		  			    }else{
		  			     // alert("请选择BOM单文件");
		  			    $(".fileNameMessage").html("请选择BOM单文件");
		  			    }
		  			});
		  //BOM单导入功能 end
		});

});