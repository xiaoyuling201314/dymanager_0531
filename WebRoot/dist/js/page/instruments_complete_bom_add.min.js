require(["../config.min","../base.min"],function(){
	$(function(){//文档加载函数
		 $("#btnSave").on("click", function() {
				var completeMachineName = $("[name=completeMachineName]").val();
				var completeMachineVersion = $("[name=completeMachineVersion]").val();
				if(validate()){
					$.ajax({
						url : "completeService/checkFileVersion.do",
						type : "POST",
						dataType : "json",
						data : {
							"completeMachineName" : completeMachineName,
							"completeMachineVersion" : completeMachineVersion
						},
						success : function(data) {
							if (data.isExit == 'true') {// 存在
								alert("BOM单" + completeMachineVersion + "版本已存在,请确认BOM单名或版本号是否有误");
							} else {//验证通过进行表单提交
								 var formData = new FormData($("[name=completeForm]")[0]);  // 要求使用的html对象
							     $.ajax({  
							          async: false, 
							          url: 'completeService/addComplete.do' ,  
							          type: 'POST',  
							          data: formData, 
							          cache: false,  
							          processData: false, 
							          contentType: false,  
							          dataType:"json", 
							          success: function (returndata) { 
							            if(returndata.count>0){
							            	 alert("导入成功"+returndata.count+"条数据");
							            }else if(returndata.count==0){//未选择导入文件,不提示直接跳转页面
							            	
							            }
							            else{
							            	 alert("导入数据失败,请检查数据文件是否有误");
							            }
							            location.href=basePath+"completeService/completeList.do";
							          },  
							          error: function (returndata) {  
							              alert("操作失败");  
							          }  
							     }); 
							}
						},
						error : function() {
							alert("操作失败");
						}
					});
				}
			
			});

		  $("#returnbtn").on("click",function(){
			     if($("[name=completeMachineName]").val()!='' || $("[name=completeMachineVersion]").val()!='' || $("[name=createPerson]").val()!=''){
			        if(confirm("确定放弃编辑返回吗？")){
			           location.href=basePath+"completeService/completeList.do";
			        }
			       }else{
			          location.href=basePath+"completeService/completeList.do";
			       }
		     });
	});
	
});