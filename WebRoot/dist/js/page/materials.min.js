require(["../config.min","../base.min"],
		function(){require(["common/lightbox.min"],
				function(n){n.run(".gallery")}),require(["common/pagination.min"],
						function(){$("#pagination").pagination({pageCount:pageCount,current:curPage,callback:function(n){var t=n.getCurrent();$("#materForm input[name='curPage']").val(t),$("#materForm").submit()}})}),require(["common/modal.min"]),
						require(["common/select.min"],function(n){n.selectAll("selectAll","for-all")}),
 						require([ "common/alert.min" ], function(n) {
		$(".delete").on("click", function() {
			var materielNo = $(this).attr("data-id");
			n.confirm("您确定要删除吗？", function() {
				$.ajax({
					url : "materielService/deleteMateriel.do",
					type : "POST",
					data : {
						"materielNo" : materielNo,"curPage":curPage
					},
					dataType:"json",
					success : function(data) {
						//alert("删除成功(＾－＾)V");
						var json = eval(data); //数组  
						$("#materielList tr").empty("");
						var serNo=(pDataStartIndex+1);
				               $.each(json, function (index, item) {  
				                   //循环获取数据      
				                   //var serNo=(index+1);  
				            	   	  $("#materielList").append("<tr><td>"+(serNo+index)+"</td><td>"+json[index].materielNo+"</td><td>"+json[index].materielTypeId.materielTypeName+"</td><td style='text-align: left;'>"+json[index].materielName+"</td><td style='text-align: left;'>"+json[index].modelSpecification+"</td><td>"+json[index].footprint+"</td><td>"+json[index].comment+"</td><td class='gallery'><c:forEach items='"+json[index].picture+"' var='pict' varStatus='index'><c:if test='${index.index==0 }'><a href='${picturePath}${pict}'><img width='20px' height='20px' alt='图片' src='dist/img/pic.png'></a></c:if><c:if test='${index.index!=0 }'><a style='display: none;' href='${picturePath}${pict}'>${pict}</a></c:if></c:forEach></td><td><c:if test='"+json[index].drawings!=null && json[index].drawings.size>0 +"'><a href='#drawingModal' class='viewDrawing' data-id='"+json[index].materielNo+"' data-action='modal'><img width='20px' height='20px' alt='图纸' src='dist/img/draws.png'></a></c:if></td><td><a href='materielService/selectDetail.do?materielNo="+json[index].materielNo+"'><i class='iconfont icon-edit'></i></a><a class='delete' data-id='"+json[index].materielNo+"'><i class='iconfont icon-delete'></i></a></td></tr>");
				            });
						location.reload();
					},
					error : function() {
						alert("删除失败o(╯□╰)o");
					}
				})
			})
		})
	})
});